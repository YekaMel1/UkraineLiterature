import { useState, useEffect, useRef } from "react";
import { useRoute, useLocation } from "wouter";
import { Button } from "@/components/ui/button";
import { useMutation } from "@tanstack/react-query";
import { useToast } from "@/hooks/use-toast";
import { apiRequest, queryClient } from "@/lib/queryClient";
import { useTest } from "@/lib/hooks";
import { useAuth } from "@/hooks/use-auth";
import { Clock, ArrowLeft, HelpCircle, CheckCircle, XCircle, Loader2 } from "lucide-react";

type Question = {
  id: number;
  text: string;
  options: string[];
  correctAnswer: number;
};

// Типи питань у тесті
enum QuestionType {
  MultipleChoice = "multiple",
  TrueFalse = "truefalse",
  Matching = "matching",
}

// Інтерфейс для відповіді на запитання
type UserAnswer = {
  questionId: number;
  answerId: number | null;
};

export default function TestPage() {
  const [, params] = useRoute("/test/:id");
  const [, navigate] = useLocation();
  const testId = params?.id ? parseInt(params.id) : 0;
  const { user } = useAuth();
  const { toast } = useToast();
  
  // Повертаємось до простого стану без useRef
  const [currentQuestionIndex, setCurrentQuestionIndex] = useState(0);
  const [userAnswers, setUserAnswers] = useState<UserAnswer[]>([]);
  const [timeLeft, setTimeLeft] = useState(0);
  const [showResults, setShowResults] = useState(false);
  
  console.log("Початковий стан showResults:", false);
  
  const { data: test, isLoading } = useTest(testId);
  
  // Масив для зберігання питань
  const [questions, setQuestions] = useState<Question[]>([]);
  
  // Додамо логування для діагностики
  useEffect(() => {
    console.log("Поточний URL:", window.location.href);
    console.log("Параметри тесту:", params);
    console.log("TestId:", testId);
  }, []);
  
  // Заповнюємо питання, коли тест завантажено
  useEffect(() => {
    if (test) {
      console.log("Завантажено тест:", test);
      let generatedQuestions: Question[] = [];
      
      // Визначення питань залежно від типу тесту
      if (test.testType === "book") {
        if (test.title.includes("Кайдашева сім'я")) {
          generatedQuestions = [
            {
              id: 1,
              text: "Хто автор твору \"Кайдашева сім'я\"?",
              options: ["Іван Нечуй-Левицький", "Панас Мирний", "Михайло Коцюбинський", "Іван Франко"],
              correctAnswer: 0
            },
            {
              id: 2,
              text: "У якому жанрі написано твір \"Кайдашева сім'я\"?",
              options: ["Роман", "Повість", "Оповідання", "Новела"],
              correctAnswer: 1
            },
            {
              id: 3,
              text: "Причина конфлікту між Кайдашихою та Мотрею?",
              options: ["Придане Мотрі", "Поділ городу", "Посуд і хатні речі", "Усі варіанти правильні"],
              correctAnswer: 3
            },
            {
              id: 4,
              text: "Що символізує груша у творі \"Кайдашева сім'я\"?",
              options: ["Достаток", "Родючість", "Причину конфлікту та ворожнечі", "Єдність родини"],
              correctAnswer: 2
            },
            {
              id: 5,
              text: "Яка проблематика твору \"Кайдашева сім'я\"?",
              options: ["Протистояння батьків і дітей", "Зображення сільського побуту", "Проблеми власності та межі", "Усі варіанти правильні"],
              correctAnswer: 3
            },
            {
              id: 6,
              text: "Які брати Кайдаші одружуються першими?",
              options: ["Лаврін", "Карпо", "Вони одружуються одночасно", "У творі немає одруження"],
              correctAnswer: 1
            },
            {
              id: 7,
              text: "Як у творі зображено побут українського села?",
              options: ["Ідеалізовано", "Сатирично", "Реалістично", "Фантастично"],
              correctAnswer: 2
            },
            {
              id: 8, 
              text: "Особливості мови твору \"Кайдашева сім'я\"?",
              options: ["Багата на діалектизми", "Книжна", "Канцелярська", "Наукова"],
              correctAnswer: 0
            },
            {
              id: 9,
              text: "Чим закінчується твір \"Кайдашева сім'я\"?",
              options: ["Примиренням родини", "Поділом господарства", "Смертю батька", "Розповіддю про спір за грушу"],
              correctAnswer: 3
            },
            {
              id: 10,
              text: "Який художній напрям представляє твір \"Кайдашева сім'я\"?",
              options: ["Романтизм", "Сентименталізм", "Реалізм", "Модернізм"],
              correctAnswer: 2
            }
          ];
        } else if (test.title.includes("Тіні забутих предків")) {
          generatedQuestions = [
            {
              id: 1,
              text: "Хто автор твору \"Тіні забутих предків\"?",
              options: ["Іван Франко", "Михайло Коцюбинський", "Ольга Кобилянська", "Василь Стефаник"],
              correctAnswer: 1
            },
            {
              id: 2,
              text: "В якому регіоні України відбуваються події твору \"Тіні забутих предків\"?",
              options: ["На Поділлі", "На Полтавщині", "На Гуцульщині", "На Волині"],
              correctAnswer: 2
            },
            {
              id: 3,
              text: "Як звали кохану Івана Палійчука?",
              options: ["Марічка", "Палагна", "Калина", "Ярина"],
              correctAnswer: 0
            },
            {
              id: 4,
              text: "Що сталося з Марічкою?",
              options: ["Вийшла заміж за іншого", "Захворіла", "Потонула в річці", "Пішла в монастир"],
              correctAnswer: 2
            },
            {
              id: 5,
              text: "Хто такий мольфар у творі?",
              options: ["Священик", "Чарівник, чаклун", "Лісоруб", "Музикант"],
              correctAnswer: 1
            },
            {
              id: 6,
              text: "Родини Івана і Марічки були:",
              options: ["Друзями", "Ворогами", "Родичами", "Сусідами"],
              correctAnswer: 1
            },
            {
              id: 7,
              text: "Що заважало щастю Івана та Марічки?",
              options: ["Ворожнеча родин", "Бідність", "Хвороба", "Ворожнеча родин і бідність"],
              correctAnswer: 3
            },
            {
              id: 8,
              text: "На кому Іван одружився після смерті Марічки?",
              options: ["Марина", "Палагна", "Калина", "Він не одружувався вдруге"],
              correctAnswer: 1
            },
            {
              id: 9,
              text: "Юра-мольфар у творі є:",
              options: ["Другом Івана", "Ворогом Івана", "Коханцем Палагни", "Батьком Марічки"],
              correctAnswer: 2
            },
            {
              id: 10,
              text: "Що бачить Іван перед смертю?",
              options: ["Марічку", "Палагну", "Юру-мольфара", "Свою матір"],
              correctAnswer: 0
            },
            {
              id: 11,
              text: "До якого літературного напряму належить повість \"Тіні забутих предків\"?",
              options: ["Реалізм", "Імпресіонізм", "Неоромантизм", "Сентименталізм"],
              correctAnswer: 1
            },
            {
              id: 12,
              text: "Які вірування гуцулів описані у творі?",
              options: ["Християнство", "Язичництво", "Синтез християнства і язичництва", "Буддизм"],
              correctAnswer: 2
            }
          ];
        } else if (test.title.includes("Лісова пісня")) {
          generatedQuestions = [
            {
              id: 1,
              text: "Хто автор драми-феєрії \"Лісова пісня\"?",
              options: ["Іван Франко", "Тарас Шевченко", "Леся Українка", "Ліна Костенко"],
              correctAnswer: 2
            },
            {
              id: 2,
              text: "Хто такий Лукаш у творі?",
              options: ["Лісовик", "Сільський парубок", "Водяник", "Дядько Мавки"],
              correctAnswer: 1
            },
            {
              id: 3,
              text: "Хто така Мавка у творі?",
              options: ["Лісова істота", "Дружина Лукаша", "Сестра Килини", "Мати Лукаша"],
              correctAnswer: 0
            },
            {
              id: 4,
              text: "Хто перетворив Лукаша на вовкулаку?",
              options: ["Мавка", "Лісовик", "Водяник", "Лісовий цар"],
              correctAnswer: 1
            },
            {
              id: 5,
              text: "Яка основна ідея твору \"Лісова пісня\"?",
              options: ["Протистояння людини і природи", "Конфлікт матеріального і духовного", "Проблема самопізнання людини", "Усі варіанти правильні"],
              correctAnswer: 3
            },
            {
              id: 6,
              text: "У якому жанрі написано \"Лісову пісню\"?",
              options: ["Трагедія", "Комедія", "Драма-феєрія", "Мелодрама"],
              correctAnswer: 2
            },
            {
              id: 7,
              text: "Хто така Килина у творі?",
              options: ["Мати Лукаша", "Дружина Лукаша", "Сестра Мавки", "Знайома Лісовика"],
              correctAnswer: 1
            },
            {
              id: 8,
              text: "На чому грає Лукаш у творі?",
              options: ["На сопілці", "На скрипці", "На бандурі", "На гуслях"],
              correctAnswer: 0
            },
            {
              id: 9,
              text: "Чим закінчується \"Лісова пісня\"?",
              options: ["Весіллям Лукаша та Мавки", "Смертю Мавки", "Перетворенням Мавки на вербу", "Продовженням кохання Мавки та Лукаша"],
              correctAnswer: 3
            },
            {
              id: 10,
              text: "Хто така Доля у творі?",
              options: ["Богиня долі", "Мати Мавки", "Сестра Мавки", "Дружина Лісовика"],
              correctAnswer: 0
            },
            {
              id: 11,
              text: "Коли відбуваються події у \"Лісовій пісні\"?",
              options: ["Взимку", "Влітку", "Протягом різних пір року", "Восени"],
              correctAnswer: 2
            },
            {
              id: 12,
              text: "З чого зроблена сопілка Лукаша?",
              options: ["З верби", "З калини", "З очерету", "З дуба"],
              correctAnswer: 1
            },
            {
              id: 13,
              text: "Кого з лісових істот немає у творі?",
              options: ["Водяник", "Лісовик", "Перелесник", "Домовик"],
              correctAnswer: 3
            },
            {
              id: 14,
              text: "Хто така дядькова дружина у творі?",
              options: ["Килина", "Лукашева мати", "Мавка", "Доля"],
              correctAnswer: 1
            },
            {
              id: 15,
              text: "Яке місце у творі можна вважати символом духовності?",
              options: ["Хату Лукаша", "Озеро", "Ліс", "Поле"],
              correctAnswer: 2
            }
          ];
        } else if (test.title.includes("Кобзар") || test.title.includes("Шевченка")) {
          generatedQuestions = [
            {
              id: 1,
              text: "У якому році було вперше опубліковано \"Кобзар\" Тараса Шевченка?",
              options: ["1830", "1840", "1850", "1860"],
              correctAnswer: 1
            },
            {
              id: 2,
              text: "Скільки творів увійшло до першого видання \"Кобзаря\"?",
              options: ["6", "8", "12", "15"],
              correctAnswer: 0
            },
            {
              id: 3,
              text: "Як називається перший твір у першому виданні \"Кобзаря\"?",
              options: ["Заповіт", "Причинна", "Думи мої", "Катерина"],
              correctAnswer: 2
            },
            {
              id: 4,
              text: "Хто профінансував перше видання \"Кобзаря\"?",
              options: ["Михайло Максимович", "Євген Гребінка", "Петро Мартос", "Микола Костомаров"],
              correctAnswer: 2
            },
            {
              id: 5,
              text: "Які з поезій належать до циклу \"В казематі\"?",
              options: ["Сон", "Садок вишневий коло хати", "Кавказ", "Доля"],
              correctAnswer: 1
            },
            {
              id: 6,
              text: "Кому присвячено поему \"Катерина\"?",
              options: ["Івану Сошенку", "Василю Жуковському", "Євгену Гребінці", "Петру Мартосу"],
              correctAnswer: 2
            },
            {
              id: 7,
              text: "У якому році було написано \"Заповіт\"?",
              options: ["1840", "1845", "1850", "1860"],
              correctAnswer: 1
            },
            {
              id: 8,
              text: "Яка історична постать є героєм поеми \"Гайдамаки\"?",
              options: ["Богдан Хмельницький", "Іван Мазепа", "Іван Гонта", "Петро Сагайдачний"],
              correctAnswer: 2
            },
            {
              id: 9,
              text: "Хто ілюстрував перше видання \"Кобзаря\"?",
              options: ["Сам Шевченко", "Ілля Рєпін", "Василь Штернберг", "Микола Ге"],
              correctAnswer: 0
            },
            {
              id: 10,
              text: "За яким твором Тараса Шевченка було знято перший український повнометражний фільм?",
              options: ["Катерина", "Наймичка", "Назар Стодоля", "Тарасова ніч"],
              correctAnswer: 2
            },
            {
              id: 11,
              text: "У якому творі Тараса Шевченка є рядки \"Реве та стогне Дніпр широкий\"?",
              options: ["Заповіт", "Причинна", "Катерина", "Гайдамаки"],
              correctAnswer: 1
            },
            {
              id: 12,
              text: "У якому творі Тараса Шевченка є рядки \"Обніміте ж, брати мої, найменшого брата\"?",
              options: ["Заповіт", "І мертвим, і живим...", "Кавказ", "Сон"],
              correctAnswer: 1
            },
            {
              id: 13,
              text: "Який твір Тараса Шевченка має підзаголовок \"Комедія\"?",
              options: ["Сон", "Катерина", "Кавказ", "Гайдамаки"],
              correctAnswer: 0
            },
            {
              id: 14,
              text: "Який твір Тараса Шевченка присвячено Якову де Бальмену?",
              options: ["Сон", "Кавказ", "Заповіт", "Гайдамаки"],
              correctAnswer: 1
            }
          ];
        } else if (test.title.includes("Захар Беркут")) {
          generatedQuestions = [
            {
              id: 1,
              text: "Хто автор історичної повісті \"Захар Беркут\"?",
              options: ["Іван Франко", "Михайло Коцюбинський", "Іван Нечуй-Левицький", "Ольга Кобилянська"],
              correctAnswer: 0
            },
            {
              id: 2,
              text: "У якому столітті відбуваються події твору \"Захар Беркут\"?",
              options: ["XII", "XIII", "XIV", "XV"],
              correctAnswer: 1
            },
            {
              id: 3,
              text: "Хто наступає на тухольські землі у творі \"Захар Беркут\"?",
              options: ["Поляки", "Татаро-монголи", "Турки", "Угорці"],
              correctAnswer: 1
            },
            {
              id: 4,
              text: "Як звати сина Захара Беркута?",
              options: ["Максим", "Тугар", "Мирослав", "Петро"],
              correctAnswer: 0
            },
            {
              id: 5,
              text: "Як у творі зображено стосунки Максима та Мирослави?",
              options: ["Вороги", "Друзі", "Родичі", "Закохана пара"],
              correctAnswer: 3
            },
            {
              id: 6,
              text: "Яку кару було призначено для зрадників Тухольською громадою?",
              options: ["Заслання", "Страта", "Вигнання", "Ув'язнення"],
              correctAnswer: 2
            },
            {
              id: 7,
              text: "Хто такий Тугар Вовк у творі?",
              options: ["Ватажок монголів", "Боярин", "Старійшина громади", "Брат Захара"],
              correctAnswer: 1
            },
            {
              id: 8,
              text: "Яким способом тухольці перемогли монголів?",
              options: ["Підпалили ліс", "Затопили долину", "Отруїли воду", "Організували засідку"],
              correctAnswer: 1
            },
            {
              id: 9,
              text: "Що Захар Беркут вважав найбільшою цінністю?",
              options: ["Особисте багатство", "Громаду", "Княжу владу", "Фізичну силу"],
              correctAnswer: 1
            },
            {
              id: 10,
              text: "Як закінчується повість \"Захар Беркут\"?",
              options: ["Весіллям Максима і Мирослави", "Загибеллю усіх героїв", "Смертю Захара та перемогою громади", "Поразкою тухольців"],
              correctAnswer: 2
            },
            {
              id: 11,
              text: "Яку роль виконують роздуми Захара Беркута у творі?",
              options: ["Філософську", "Гумористичну", "Ліричну", "Бойову"],
              correctAnswer: 0
            },
            {
              id: 12,
              text: "У якому році був написаний \"Захар Беркут\"?",
              options: ["1880", "1883", "1890", "1901"],
              correctAnswer: 1
            },
            {
              id: 13,
              text: "Хто такий Бурунда у творі?",
              options: ["Монгольський воєначальник", "Тухольський воїн", "Боярин", "Брат Тугара"],
              correctAnswer: 0
            },
            {
              id: 14,
              text: "Який суспільний лад описано у творі \"Захар Беркут\"?",
              options: ["Феодальний", "Патріархальний", "Громадівський (демократичний)", "Рабовласницький"],
              correctAnswer: 2
            },
            {
              id: 15,
              text: "Як Іван Франко характеризує повість \"Захар Беркут\"?",
              options: ["Як історичну", "Як фантастичну", "Як побутову", "Як біографічну"],
              correctAnswer: 0
            }
          ];
        } else if (test.title.includes("Енеїда")) {
          generatedQuestions = [
            {
              id: 1,
              text: "Хто автор \"Енеїди\"?",
              options: ["Григорій Сковорода", "Іван Котляревський", "Тарас Шевченко", "Іван Франко"],
              correctAnswer: 1
            },
            {
              id: 2,
              text: "У якому році було видано перші три частини \"Енеїди\"?",
              options: ["1798", "1800", "1808", "1842"],
              correctAnswer: 0
            },
            {
              id: 3,
              text: "Який прийом використав Іван Котляревський при створенні \"Енеїди\"?",
              options: ["Пародіювання", "Травестування", "Алегорію", "Гротеск"],
              correctAnswer: 1
            },
            {
              id: 4,
              text: "Який твір послужив основою для \"Енеїди\" Котляревського?",
              options: ["\"Енеїда\" Вергілія", "\"Одіссея\" Гомера", "\"Іліада\" Гомера", "\"Декамерон\" Боккаччо"],
              correctAnswer: 0
            },
            {
              id: 5,
              text: "Хто такий Еней у творі?",
              options: ["Втікач із Трої", "Козацький ватажок", "Бог", "Всі відповіді правильні"],
              correctAnswer: 3
            },
            {
              id: 6,
              text: "Яку найбільшу кількість харчів описано в \"Енеїді\"?",
              options: ["Близько 40 страв", "Близько 60 страв", "Близько 80 страв", "Близько 120 страв"],
              correctAnswer: 3
            },
            {
              id: 7,
              text: "Хто з богів найбільше допомагає Енеєві?",
              options: ["Юнона", "Венера", "Зевс", "Нептун"],
              correctAnswer: 1
            },
            {
              id: 8,
              text: "Як Еней потрапив до пекла?",
              options: ["Його туди відправила Юнона", "Він пішов з власної волі", "Його викрали чорти", "Його запросив Плутон"],
              correctAnswer: 1
            },
            {
              id: 9,
              text: "На чому зосереджено увага при описі пекла?",
              options: ["На муках грішників", "На багатстві Плутона", "На критиці соціальних вад", "На зображенні чортів"],
              correctAnswer: 2
            },
            {
              id: 10,
              text: "Як звали царівну, з якою Еней мав одружитися?",
              options: ["Лавінія", "Дідона", "Юнона", "Венера"],
              correctAnswer: 0
            },
            {
              id: 11,
              text: "Скільки всього частин має \"Енеїда\"?",
              options: ["3", "4", "6", "8"],
              correctAnswer: 2
            },
            {
              id: 12,
              text: "Ким є троянці в інтерпретації Котляревського?",
              options: ["Греками", "Римлянами", "Українськими козаками", "Селянами"],
              correctAnswer: 2
            },
            {
              id: 13,
              text: "Який жанр \"Енеїди\" Котляревського?",
              options: ["Поема", "Роман у віршах", "Повість", "Комедія"],
              correctAnswer: 0
            },
            {
              id: 14,
              text: "Коли було надруковано повне видання \"Енеїди\"?",
              options: ["1842", "1798", "1808", "1820"],
              correctAnswer: 0
            },
            {
              id: 15,
              text: "Хто видав перші три частини \"Енеїди\" без відома автора?",
              options: ["Максим Парпура", "Микола Гнідич", "Петро Пліткін", "Іван Карпенко"],
              correctAnswer: 0
            },
            {
              id: 16,
              text: "У чому полягає історичне значення \"Енеїди\" Котляревського?",
              options: ["Це перший твір нової української літератури", "Це перший переклад з латини", "Це перший твір про Стародавній Рим", "Це перший твір про козаків"],
              correctAnswer: 0
            },
            {
              id: 17,
              text: "Хто наказав спалити Трою у творі?",
              options: ["Зевс", "Юнона", "Нептун", "Венера"],
              correctAnswer: 1
            },
            {
              id: 18,
              text: "Яка основна риса характеру Енея?",
              options: ["Хоробрість", "Хитрість", "Вірність", "Всі відповіді правильні"],
              correctAnswer: 3
            }
          ];
        } else if (test.title.includes("Хіба ревуть воли")) {
          generatedQuestions = [
            {
              id: 1,
              text: "Хто автор роману \"Хіба ревуть воли, як ясла повні?\"?",
              options: ["Іван Нечуй-Левицький", "Панас Мирний та Іван Білик", "Михайло Коцюбинський", "Іван Франко"],
              correctAnswer: 1
            },
            {
              id: 2,
              text: "Як звали головного героя роману?",
              options: ["Грицько Чупруненко", "Чіпка Варениченко", "Максим Ґудзь", "Лаврін Кайдаш"],
              correctAnswer: 1
            },
            {
              id: 3,
              text: "Яке прізвисько мав Чіпка в дитинстві?",
              options: ["Вовкулака", "Розбишака", "Придибалка", "Скажений"],
              correctAnswer: 2
            },
            {
              id: 4,
              text: "Хто з цих персонажів не входив до \"компанії\" Чіпки?",
              options: ["Лушня", "Матня", "Грицько", "Пацюк"],
              correctAnswer: 2
            },
            {
              id: 5,
              text: "Яка дівчина стала дружиною Чіпки?",
              options: ["Мотря", "Галя", "Христя", "Ганна"],
              correctAnswer: 1
            },
            {
              id: 6,
              text: "Чому роман має таку назву?",
              options: ["Це прислів'я", "Цитата з Біблії", "Вислів одного з героїв", "Цитата з народної пісні"],
              correctAnswer: 2
            },
            {
              id: 7,
              text: "Який соціальний лад критикують автори роману?",
              options: ["Капіталізм", "Феодалізм", "Колоніалізм", "Кріпосницький лад"],
              correctAnswer: 3
            },
            {
              id: 8,
              text: "Хто такий Максим Ґудзь у творі?",
              options: ["Батько Чіпки", "Дід Чіпки", "Сусід Чіпки", "Приятель Чіпки"],
              correctAnswer: 0
            },
            {
              id: 9,
              text: "Яку професію спочатку обрав Чіпка?",
              options: ["Хлібороб", "Козак", "Розбійник", "Торговець"],
              correctAnswer: 0
            },
            {
              id: 10,
              text: "З якої причини Чіпка стає на злочинний шлях?",
              options: ["З бідності", "Через позбавлення землі", "Через вплив товаришів", "Всі відповіді правильні"],
              correctAnswer: 3
            },
            {
              id: 11,
              text: "Хто виховував Чіпку в дитинстві?",
              options: ["Батько і мати", "Тільки мати", "Тільки дід", "Мати і дід"],
              correctAnswer: 3
            },
            {
              id: 12,
              text: "Чим закінчується доля Чіпки у романі?",
              options: ["Смертю", "Каторгою", "Весіллям", "Перемогою"],
              correctAnswer: 1
            },
            {
              id: 13,
              text: "Який літературний напрям представляє роман \"Хіба ревуть воли, як ясла повні?\"?",
              options: ["Романтизм", "Реалізм", "Модернізм", "Сентименталізм"],
              correctAnswer: 1
            },
            {
              id: 14,
              text: "Хто такий Чижик у творі?",
              options: ["Писар", "Суддя", "Поміщик", "Козак"],
              correctAnswer: 0
            },
            {
              id: 15,
              text: "Як звали матір Чіпки?",
              options: ["Мотря", "Галя", "Христя", "Явдоха"],
              correctAnswer: 0
            },
            {
              id: 16,
              text: "Хто такий Грицько Чупруненко у творі?",
              options: ["Ворог Чіпки", "Товариш дитинства Чіпки", "Дядько Чіпки", "Син Чіпки"],
              correctAnswer: 1
            },
            {
              id: 17,
              text: "У якому році було вперше опубліковано роман?",
              options: ["1875", "1880", "1885", "1890"],
              correctAnswer: 1
            },
            {
              id: 18,
              text: "Який із цих персонажів твору є позитивним образом?",
              options: ["Чіпка", "Максим", "Грицько", "Лушня"],
              correctAnswer: 2
            },
            {
              id: 19,
              text: "Як у романі показано причини злочинності?",
              options: ["Як вроджену рису", "Як наслідок поганого виховання", "Як результат соціальної несправедливості", "Всі відповіді правильні"],
              correctAnswer: 3
            },
            {
              id: 20,
              text: "Яким псевдонімом підписаний роман \"Хіба ревуть воли, як ясла повні?\"?",
              options: ["Панас Мирний", "Іван Білик", "Панас Мирний та Іван Білик", "Панас Рудченко"],
              correctAnswer: 0
            }
          ];
        } else if (test.title.includes("Маруся Чурай")) {
          generatedQuestions = [
            {
              id: 1,
              text: "Хто автор історичного роману у віршах \"Маруся Чурай\"?",
              options: ["Ліна Костенко", "Леся Українка", "Оксана Забужко", "Марія Матіос"],
              correctAnswer: 0
            },
            {
              id: 2,
              text: "У якому столітті відбуваються події твору \"Маруся Чурай\"?",
              options: ["XVI", "XVII", "XVIII", "XIX"],
              correctAnswer: 1
            },
            {
              id: 3,
              text: "У якому місті відбувається суд над Марусею Чурай?",
              options: ["Київ", "Полтава", "Чигирин", "Львів"],
              correctAnswer: 1
            },
            {
              id: 4,
              text: "У чому звинувачують Марусю на суді?",
              options: ["У зраді", "У вбивстві", "У чаклунстві", "У підпалі"],
              correctAnswer: 1
            },
            {
              id: 5,
              text: "Хто заступився за Марусю під час суду?",
              options: ["Богдан Хмельницький", "Іван Іскра", "Лесько Черкес", "Мартин Пушкар"],
              correctAnswer: 1
            },
            {
              id: 6,
              text: "Яке рішення ухвалив Богдан Хмельницький щодо Марусі?",
              options: ["Стратити", "Ув'язнити", "Вислати", "Помилувати"],
              correctAnswer: 3
            },
            {
              id: 7,
              text: "Як звали зрадливого нареченого Марусі?",
              options: ["Грицько Бобренко", "Іван Іскра", "Василь Перебийніс", "Павло Чорнокрил"],
              correctAnswer: 0
            },
            {
              id: 8,
              text: "Чим прославилася Маруся Чурай у творі?",
              options: ["Мужністю в бою", "Красою", "Піснями", "Вмінням лікувати"],
              correctAnswer: 2
            },
            {
              id: 9,
              text: "Скільки розділів має роман \"Маруся Чурай\"?",
              options: ["5", "7", "9", "12"],
              correctAnswer: 2
            },
            {
              id: 10,
              text: "Яка пісня згадується в романі як твір Марусі Чурай?",
              options: ["Ой не ходи, Грицю", "Засвіт встали козаченьки", "Ой у полі три криниченьки", "Всі відповіді правильні"],
              correctAnswer: 3
            },
            {
              id: 11,
              text: "Яка подія стає поштовхом для розповіді про Марусю?",
              options: ["Весілля Гриця", "Бій під Полтавою", "Суд над Марусею", "Смерть її батька"],
              correctAnswer: 2
            },
            {
              id: 12,
              text: "Що зробила Маруся після помилування?",
              options: ["Вийшла заміж", "Пішла в монастир", "Поїхала до Києва", "Залишилася в Полтаві"],
              correctAnswer: 2
            },
            {
              id: 13,
              text: "Як загинув батько Марусі?",
              options: ["У бою", "Від хвороби", "Був страчений", "При пожежі"],
              correctAnswer: 0
            },
            {
              id: 14,
              text: "Хто така Галя Вишняківна у творі?",
              options: ["Сестра Марусі", "Суперниця Марусі", "Подруга Марусі", "Мати Гриця"],
              correctAnswer: 1
            },
            {
              id: 15,
              text: "Чому Гриць зрадив Марусю?",
              options: ["Через гроші", "Через страх", "Через роздвоєність натури", "Через чари"],
              correctAnswer: 2
            },
            {
              id: 16,
              text: "Яка основна ідея роману \"Маруся Чурай\"?",
              options: ["Засудження зради", "Оспівування кохання", "Возвеличення народної творчості", "Всі відповіді правильні"],
              correctAnswer: 3
            }
          ];
        } else if (test.title.includes("Інтернат")) {
          generatedQuestions = [
            {
              id: 1,
              text: "Хто автор роману \"Інтернат\"?",
              options: ["Сергій Жадан", "Юрій Андрухович", "Оксана Забужко", "Тарас Прохасько"],
              correctAnswer: 0
            },
            {
              id: 2,
              text: "Якій темі присвячено роман \"Інтернат\"?",
              options: ["Голодомору", "Другій світовій війні", "Війні на Донбасі", "Чорнобильській катастрофі"],
              correctAnswer: 2
            },
            {
              id: 3,
              text: "Як звати головного героя роману?",
              options: ["Сергій", "Паша", "Гриша", "Анатолій"],
              correctAnswer: 1
            },
            {
              id: 4,
              text: "Яка професія головного героя роману?",
              options: ["Військовий", "Вчитель", "Лікар", "Журналіст"],
              correctAnswer: 1
            },
            {
              id: 5,
              text: "За ким головний герой вирушає в небезпечну подорож?",
              options: ["За сестрою", "За племінницею", "За племінником", "За другом"],
              correctAnswer: 2
            },
            {
              id: 6,
              text: "Як звати племінника головного героя?",
              options: ["Сашко", "Петро", "Микола", "Олег"],
              correctAnswer: 0
            },
            {
              id: 7,
              text: "Що символізує інтернат у романі?",
              options: ["Безпеку", "Владу", "Війну", "Знедоленість"],
              correctAnswer: 0
            },
            {
              id: 8,
              text: "Який часовий проміжок охоплюють події роману?",
              options: ["Один день", "Тиждень", "Три дні", "Місяць"],
              correctAnswer: 2
            },
            {
              id: 9,
              text: "Якою є основна ідея роману \"Інтернат\"?",
              options: ["Засудження війни", "Критика влади", "Необхідність визначення своєї позиції", "Всі відповіді правильні"],
              correctAnswer: 3
            },
            {
              id: 10,
              text: "У якому році було опубліковано роман \"Інтернат\"?",
              options: ["2015", "2017", "2019", "2021"],
              correctAnswer: 1
            }
          ];
        } else {
          // Загальні питання з української літератури для інших творів
          generatedQuestions = [
            {
              id: 1,
              text: `У якому столітті написано твір "${test.title}"?`,
              options: ["XVIII", "XIX", "XX", "XXI"],
              correctAnswer: test.title.includes("Енеїда") ? 0 : (test.title.includes("Захар Беркут") ? 1 : 2)
            },
            {
              id: 2,
              text: `До якого літературного напряму належить твір "${test.title}"?`,
              options: ["Романтизм", "Реалізм", "Модернізм", "Постмодернізм"],
              correctAnswer: test.title.includes("Тіні") ? 2 : (test.title.includes("Мойсей") ? 0 : 1)
            },
            {
              id: 3,
              text: `Який жанр твору "${test.title}"?`,
              options: ["Роман", "Повість", "Поема", "Драма"],
              correctAnswer: test.title.includes("Енеїда") ? 2 : (test.title.includes("Лісова пісня") ? 3 : 1)
            },
            {
              id: 4,
              text: `Яка основна тема твору "${test.title}"?`,
              options: ["Кохання", "Національна ідентичність", "Протистояння добра і зла", "Моральний вибір людини"],
              correctAnswer: test.title.includes("Маруся Чурай") ? 1 : (test.title.includes("Земля") ? 0 : 2)
            },
            {
              id: 5,
              text: `Який художній прийом найбільш характерний для твору "${test.title}"?`,
              options: ["Гротеск", "Символізм", "Психологізм", "Алегорія"],
              correctAnswer: test.title.includes("Тіні") ? 1 : (test.title.includes("Лісова пісня") ? 1 : 2)
            },
            {
              id: 6,
              text: `Які історичні події описуються у творі "${test.title}"?`,
              options: ["Козацька доба", "Період кріпацтва", "Міжвоєнний період", "Сучасність"],
              correctAnswer: test.title.includes("Маруся Чурай") ? 0 : (test.title.includes("Хіба ревуть воли") ? 1 : 2)
            },
            {
              id: 7,
              text: `Який конфлікт є центральним у творі "${test.title}"?`,
              options: ["Між поколіннями", "Між людиною і суспільством", "Між людиною і природою", "Між добром і злом"],
              correctAnswer: test.title.includes("Кайдашева сім'я") ? 0 : (test.title.includes("Тіні забутих предків") ? 2 : 1)
            },
            {
              id: 8,
              text: `Як критики характеризують стиль твору "${test.title}"?`,
              options: ["Епічний", "Ліричний", "Драматичний", "Психологічний"],
              correctAnswer: test.title.includes("Мойсей") ? 1 : (test.title.includes("Лісова пісня") ? 2 : 3)
            }
          ];
        }
      } else if (test.testType === "quote") {
        // Питання для тесту на цитати в залежності від тесту
        if (test.title.includes("Вгадай цитату") || test.title.includes("Цитати класиків")) {
          generatedQuestions = [
            {
              id: 1,
              text: "Хто автор цитати: \"Якби ви вчились так, як треба, то й мудрість би була своя.\"?",
              options: ["Тарас Шевченко", "Іван Франко", "Григорій Сковорода", "Леся Українка"],
              correctAnswer: 0
            },
            {
              id: 2,
              text: "Хто автор цитати: \"Лиш боротись - значить жить...\"?",
              options: ["Тарас Шевченко", "Іван Франко", "Леся Українка", "Василь Стус"],
              correctAnswer: 1
            },
            {
              id: 3,
              text: "Хто автор цитати: \"Слово, чому ти не твердая криця?\"?",
              options: ["Тарас Шевченко", "Іван Франко", "Леся Українка", "Ліна Костенко"],
              correctAnswer: 2
            },
            {
              id: 4,
              text: "Хто автор цитати: \"Страшні слова, коли вони мовчать\"?",
              options: ["Тарас Шевченко", "Василь Симоненко", "Павло Тичина", "Ліна Костенко"],
              correctAnswer: 3
            },
            {
              id: 5,
              text: "Хто автор цитати: \"Борітеся – поборете! Вам Бог помагає!\"?",
              options: ["Тарас Шевченко", "Іван Франко", "Леся Українка", "Володимир Сосюра"],
              correctAnswer: 0
            },
            {
              id: 6,
              text: "Хто автор цитати: \"Книги – морська глибина: хто в них пірне аж до дна, той, хоч і труду мав досить, дивнії перли виносить\"?",
              options: ["Григорій Сковорода", "Іван Франко", "Леся Українка", "Тарас Шевченко"],
              correctAnswer: 1
            },
            {
              id: 7,
              text: "Хто автор цитати: \"Contra spem spero\" (Без надії сподіваюсь)?",
              options: ["Тарас Шевченко", "Іван Франко", "Леся Українка", "Ліна Костенко"],
              correctAnswer: 2
            },
            {
              id: 8,
              text: "Хто автор цитати: \"І чужому научайтесь, й свого не цурайтесь\"?",
              options: ["Іван Котляревський", "Тарас Шевченко", "Пантелеймон Куліш", "Іван Франко"],
              correctAnswer: 1
            },
            {
              id: 9,
              text: "Хто автор цитати: \"І все на світі треба пережити, і кожен фініш - це по суті старт\"?",
              options: ["Василь Стус", "Ліна Костенко", "Василь Симоненко", "Павло Тичина"],
              correctAnswer: 1
            },
            {
              id: 10,
              text: "Хто автор цитати: \"Наша дума, наша пісня не вмре, не загине\"?",
              options: ["Тарас Шевченко", "Іван Франко", "Леся Українка", "Василь Стус"],
              correctAnswer: 0
            },
            {
              id: 11,
              text: "Хто автор цитати: \"Любов к отчизні де героїть, там сила вража не устоїть\"?",
              options: ["Іван Котляревський", "Тарас Шевченко", "Григорій Сковорода", "Іван Франко"],
              correctAnswer: 0
            },
            {
              id: 12,
              text: "Хто автор цитати: \"Світ ловив мене, та не впіймав\"?",
              options: ["Тарас Шевченко", "Іван Франко", "Григорій Сковорода", "Леся Українка"],
              correctAnswer: 2
            },
            {
              id: 13,
              text: "Хто автор цитати: \"Нації вмирають не від інфаркту. Спочатку їм відбирає мову\"?",
              options: ["Василь Стус", "Ліна Костенко", "Олесь Гончар", "Іван Драч"],
              correctAnswer: 1
            },
            {
              id: 14,
              text: "Хто автор цитати: \"Найбільше і найдорожче добро в кожного народу - це його мова\"?",
              options: ["Панас Мирний", "Тарас Шевченко", "Іван Огієнко", "Михайло Коцюбинський"],
              correctAnswer: 2
            },
            {
              id: 15,
              text: "Хто автор цитати: \"В своїй хаті своя й правда, і сила, і воля\"?",
              options: ["Тарас Шевченко", "Леся Українка", "Іван Франко", "Ліна Костенко"],
              correctAnswer: 0
            }
          ];
        } else if (test.title.includes("Афоризми письменників")) {
          generatedQuestions = [
            {
              id: 1,
              text: "Який письменник є автором афоризму: \"У щастя людського два рівних є крила: Троянди й виноград, красиве і корисне\"?",
              options: ["Максим Рильський", "Павло Тичина", "Микола Зеров", "Володимир Сосюра"],
              correctAnswer: 0
            },
            {
              id: 2,
              text: "Який письменник є автором афоризму: \"Сміливі завжди мають щастя\"?",
              options: ["Іван Котляревський", "Іван Франко", "Леся Українка", "Тарас Шевченко"],
              correctAnswer: 0
            },
            {
              id: 3,
              text: "Який письменник є автором афоризму: \"Правді завжди личить простота\"?",
              options: ["Тарас Шевченко", "Олександр Олесь", "Ліна Костенко", "Василь Симоненко"],
              correctAnswer: 3
            },
            {
              id: 4,
              text: "Який письменник є автором афоризму: \"Будьте самі собі ціллю\"?",
              options: ["Володимир Винниченко", "Микола Хвильовий", "Григорій Сковорода", "Іван Франко"],
              correctAnswer: 2
            },
            {
              id: 5,
              text: "Який письменник є автором афоризму: \"Хто має час, той не має часу його втрачати\"?",
              options: ["Ліна Костенко", "Леся Українка", "Григорій Сковорода", "Іван Франко"],
              correctAnswer: 2
            },
            {
              id: 6,
              text: "Який письменник є автором афоризму: \"Жити - значить боротися\"?",
              options: ["Іван Багряний", "Іван Франко", "Тарас Шевченко", "Василь Стус"],
              correctAnswer: 1
            },
            {
              id: 7,
              text: "Який письменник є автором афоризму: \"Хто не знає свого минулого, той не вартий свого майбутнього\"?",
              options: ["Ліна Костенко", "Максим Рильський", "Валер'ян Підмогильний", "Олесь Гончар"],
              correctAnswer: 0
            },
            {
              id: 8,
              text: "Який письменник є автором афоризму: \"Як мало відомо про життя, як багато - про літературу\"?",
              options: ["Іван Котляревський", "Ліна Костенко", "Микола Хвильовий", "Юрій Андрухович"],
              correctAnswer: 1
            },
            {
              id: 9,
              text: "Який письменник є автором афоризму: \"Не принижуй своєї мови. Не забувай наших великих традицій.\"?",
              options: ["Олесь Гончар", "Василь Стус", "Володимир Сосюра", "Павло Тичина"],
              correctAnswer: 0
            },
            {
              id: 10,
              text: "Який письменник є автором афоризму: \"Людина створила книгу, а книга — людину\"?",
              options: ["Василь Симоненко", "Остап Вишня", "Іван Багряний", "Микола Руденко"],
              correctAnswer: 0
            },
            {
              id: 11,
              text: "Який письменник є автором афоризму: \"Мова — втілення думки. Що багатша думка, то багатша мова\"?",
              options: ["Іван Огієнко", "Максим Рильський", "Борис Олійник", "Олександр Олесь"],
              correctAnswer: 1
            },
            {
              id: 12,
              text: "Який письменник є автором афоризму: \"Як парость виноградної лози, плекайте мову\"?",
              options: ["Максим Рильський", "Василь Симоненко", "Дмитро Павличко", "Микола Зеров"],
              correctAnswer: 0
            }
          ];
        } else if (test.title.includes("Поезія Шевченка")) {
          generatedQuestions = [
            {
              id: 1,
              text: "З якого твору Тараса Шевченка ці рядки: \"І мене в сем'ї великій, в сем'ї вольній, новій, не забудьте пом'янути незлим тихим словом\"?",
              options: ["\"Заповіт\"", "\"І мертвим, і живим...\"", "\"Кавказ\"", "\"Гайдамаки\""],
              correctAnswer: 0
            },
            {
              id: 2,
              text: "З якого твору Тараса Шевченка ці рядки: \"Свою Україну любіть, любіть її... Во время люте, в останню тяжкую минуту за неї Господа моліть!\"?",
              options: ["\"Сон\"", "\"Кавказ\"", "\"І мертвим, і живим...\"", "\"Чигрине, Чигрине...\""],
              correctAnswer: 3
            },
            {
              id: 3,
              text: "З якого твору Тараса Шевченка ці рядки: \"Обніміться ж, брати мої, молю вас, благаю\"?",
              options: ["\"Заповіт\"", "\"Кавказ\"", "\"Гайдамаки\"", "\"І мертвим, і живим...\""],
              correctAnswer: 3
            },
            {
              id: 4,
              text: "З якого твору Тараса Шевченка ці рядки: \"За що ж боролись ми з ляхами? За що ж ми різались з ордами? За що скородили списами московські ребра?\"?",
              options: ["\"Розрита могила\"", "\"Гайдамаки\"", "\"Великий льох\"", "\"Сон\""],
              correctAnswer: 0
            },
            {
              id: 5,
              text: "З якого твору Тараса Шевченка ці рядки: \"Борітеся — поборете, Вам Бог помагає! За вас правда, за вас слава І воля святая!\"?",
              options: ["\"І мертвим, і живим...\"", "\"Гайдамаки\"", "\"Кавказ\"", "\"Заповіт\""],
              correctAnswer: 2
            },
            {
              id: 6,
              text: "З якого твору Тараса Шевченка ці рядки: \"Учітесь, читайте, і чужому научайтесь, й свого не цурайтесь\"?",
              options: ["\"Кавказ\"", "\"І мертвим, і живим...\"", "\"Сон\"", "\"Розрита могила\""],
              correctAnswer: 1
            },
            {
              id: 7,
              text: "З якого твору Тараса Шевченка ці рядки: \"Мені однаково, чи буду я жить в Україні, чи ні\"?",
              options: ["\"Сон\"", "\"В казематі\"", "\"Заповіт\"", "\"Кавказ\""],
              correctAnswer: 1
            },
            {
              id: 8,
              text: "З якого твору Тараса Шевченка ці рядки: \"Кайдани порвіте І вражою злою кров'ю Волю окропіте\"?",
              options: ["\"Заповіт\"", "\"Кавказ\"", "\"І мертвим, і живим...\"", "\"Гайдамаки\""],
              correctAnswer: 0
            },
            {
              id: 9,
              text: "З якого твору Тараса Шевченка ці рядки: \"І на оновленій землі Врага не буде, супостата, А буде син, і буде мати, І будуть люде на землі\"?",
              options: ["\"Заповіт\"", "\"І Архімед, і Галілей...\"", "\"Кавказ\"", "\"І мертвим, і живим...\""],
              correctAnswer: 1
            },
            {
              id: 10,
              text: "З якого твору Тараса Шевченка ці рядки: \"Не вмирає душа наша, Не вмирає воля\"?",
              options: ["\"Кавказ\"", "\"Заповіт\"", "\"Гайдамаки\"", "\"І мертвим, і живим...\""],
              correctAnswer: 0
            },
            {
              id: 11,
              text: "З якого твору Тараса Шевченка ці рядки: \"А онуки? їм байдуже, Панам жито сіють!\"?",
              options: ["\"І мертвим, і живим...\"", "\"Розрита могила\"", "\"Чигрине, Чигрине...\"", "\"Гайдамаки\""],
              correctAnswer: 2
            },
            {
              id: 12,
              text: "З якого твору Тараса Шевченка ці рядки: \"Схаменіться! будьте люди, Бо лихо вам буде\"?",
              options: ["\"Кавказ\"", "\"І мертвим, і живим...\"", "\"Заповіт\"", "\"Сон\""],
              correctAnswer: 1
            },
            {
              id: 13,
              text: "З якого твору Тараса Шевченка ці рядки: \"Доборолась Україна До самого краю. Гірше ляха свої діти Її розпинають\"?",
              options: ["\"Розрита могила\"", "\"Сон\"", "\"Гайдамаки\"", "\"І мертвим, і живим...\""],
              correctAnswer: 0
            },
            {
              id: 14,
              text: "З якого твору Тараса Шевченка ці рядки: \"Не дуріте самі себе, Учітесь, читайте, І чужому научайтесь, Й свого не цурайтесь\"?",
              options: ["\"Сон\"", "\"І мертвим, і живим...\"", "\"Заповіт\"", "\"Кавказ\""],
              correctAnswer: 1
            },
            {
              id: 15,
              text: "З якого твору Тараса Шевченка ці рядки: \"Погибнеш, згинеш, Україно, Не стане знаку на землі\"?",
              options: ["\"І мертвим, і живим...\"", "\"Великий льох\"", "\"Розрита могила\"", "\"Чигрине, Чигрине...\""],
              correctAnswer: 3
            },
            {
              id: 16,
              text: "З якого твору Тараса Шевченка ці рядки: \"Од молдаванина до фіна На всіх язиках все мовчить, Бо благоденствує!\"?",
              options: ["\"Кавказ\"", "\"Сон\"", "\"Заповіт\"", "\"Чигрине, Чигрине...\""],
              correctAnswer: 1
            }
          ];
        } else if (test.title.includes("Сучасна українська література")) {
          generatedQuestions = [
            {
              id: 1,
              text: "Хто автор роману \"Ворошиловград\"?",
              options: ["Юрій Андрухович", "Сергій Жадан", "Оксана Забужко", "Софія Андрухович"],
              correctAnswer: 1
            },
            {
              id: 2,
              text: "Хто автор роману \"Солодка Даруся\"?",
              options: ["Оксана Забужко", "Юрій Андрухович", "Марія Матіос", "Сергій Жадан"],
              correctAnswer: 2
            },
            {
              id: 3,
              text: "Хто автор роману \"Музей покинутих секретів\"?",
              options: ["Юрій Андрухович", "Марія Матіос", "Оксана Забужко", "Сергій Жадан"],
              correctAnswer: 2
            },
            {
              id: 4,
              text: "Хто автор роману \"Інтернат\"?",
              options: ["Сергій Жадан", "Юрій Андрухович", "Софія Андрухович", "Оксана Забужко"],
              correctAnswer: 0
            },
            {
              id: 5,
              text: "Хто автор роману \"Фелікс Австрія\"?",
              options: ["Юрій Андрухович", "Софія Андрухович", "Оксана Забужко", "Марія Матіос"],
              correctAnswer: 1
            },
            {
              id: 6,
              text: "Хто автор роману \"Перверзія\"?",
              options: ["Юрій Андрухович", "Сергій Жадан", "Оксана Забужко", "Тарас Прохасько"],
              correctAnswer: 0
            },
            {
              id: 7,
              text: "Хто автор роману \"Польові дослідження з українського сексу\"?",
              options: ["Марія Матіос", "Софія Андрухович", "Оксана Забужко", "Ірена Карпа"],
              correctAnswer: 2
            },
            {
              id: 8,
              text: "Хто автор роману \"НепрОсті\"?",
              options: ["Юрій Андрухович", "Тарас Прохасько", "Сергій Жадан", "Оксана Забужко"],
              correctAnswer: 1
            },
            {
              id: 9,
              text: "Хто автор роману \"Записки українського самашедшого\"?",
              options: ["Ліна Костенко", "Оксана Забужко", "Марія Матіос", "Софія Андрухович"],
              correctAnswer: 0
            },
            {
              id: 10,
              text: "Хто автор роману \"Дофін Сатани\"?",
              options: ["Марія Матіос", "Юрій Андрухович", "Оксана Забужко", "Сергій Жадан"],
              correctAnswer: 0
            },
            {
              id: 11,
              text: "Хто автор роману \"Ворота Європи\"?",
              options: ["Оксана Забужко", "Юрій Андрухович", "Сергій Жадан", "Марія Матіос"],
              correctAnswer: 0
            },
            {
              id: 12,
              text: "Хто автор роману \"Параграф 78\"?",
              options: ["Сергій Жадан", "Марія Матіос", "Ірена Карпа", "Любко Дереш"],
              correctAnswer: 3
            },
            {
              id: 13,
              text: "Хто автор роману \"Рекреації\"?",
              options: ["Тарас Прохасько", "Юрій Андрухович", "Сергій Жадан", "Оксана Забужко"],
              correctAnswer: 1
            },
            {
              id: 14,
              text: "Хто автор поетичної збірки \"Цитатник\"?",
              options: ["Юрій Андрухович", "Оксана Забужко", "Сергій Жадан", "Тарас Прохасько"],
              correctAnswer: 2
            }
          ];
        } else if (test.title.includes("Земля")) {
          generatedQuestions = [
            {
              id: 1,
              text: "Хто автор повісті \"Земля\"?",
              options: ["Іван Франко", "Михайло Коцюбинський", "Ольга Кобилянська", "Василь Стефаник"],
              correctAnswer: 2
            },
            {
              id: 2,
              text: "У якому році була опублікована повість \"Земля\"?",
              options: ["1895", "1902", "1907", "1914"],
              correctAnswer: 1
            },
            {
              id: 3,
              text: "Який основний конфлікт у повісті \"Земля\"?",
              options: ["Боротьба за владу", "Суперництво за землю", "Братовбивство", "Класова боротьба"],
              correctAnswer: 2
            },
            {
              id: 4,
              text: "Яке основне символічне значення землі у творі?",
              options: ["Символ батьківщини", "Символ добробуту і достатку", "Символ життя і смерті", "Усі відповіді правильні"],
              correctAnswer: 3
            },
            {
              id: 5,
              text: "Хто є головним героєм повісті \"Земля\"?",
              options: ["Михайло", "Сава", "Івоніка", "Анна"],
              correctAnswer: 2
            },
            {
              id: 6,
              text: "Хто вбив Михайла у творі?",
              options: ["Івоніка", "Сава", "Анна", "Рахіра"],
              correctAnswer: 1
            },
            {
              id: 7,
              text: "Який літературний напрям представляє повість \"Земля\"?",
              options: ["Романтизм", "Реалізм", "Модернізм", "Експресіонізм"],
              correctAnswer: 2
            },
            {
              id: 8,
              text: "Що трапляється з Савою в кінці твору?",
              options: ["Одружується з Рахірою", "Гине від руки батька", "Потрапляє до в'язниці", "Божеволіє"],
              correctAnswer: 2
            },
            {
              id: 9,
              text: "Яку роль у творі відіграє Рахіра?",
              options: ["Вона підштовхує Саву до вбивства брата", "Вона допомагає розкрити вбивство", "Вона є символом добра", "Вона примирює братів"],
              correctAnswer: 0
            },
            {
              id: 10,
              text: "Який основний мотив повісті \"Земля\"?",
              options: ["Кохання", "Жадоба до землі", "Братерство", "Зрада"],
              correctAnswer: 1
            },
            {
              id: 11,
              text: "Яка сюжетна лінія є другорядною у творі?",
              options: ["Лінія Анни", "Лінія Петра і Докії", "Лінія Рахіри і Сави", "Лінія Івоніки і Марії"],
              correctAnswer: 1
            },
            {
              id: 12,
              text: "Як закінчується повість \"Земля\"?",
              options: ["Щасливо", "Трагічно для всіх героїв", "Загадково", "Відкритий фінал"],
              correctAnswer: 1
            }
          ];
        } else if (test.title.includes("Мойсей")) {
          generatedQuestions = [
            {
              id: 1,
              text: "Хто є автором поеми \"Мойсей\"?",
              options: ["Тарас Шевченко", "Іван Франко", "Леся Українка", "Ліна Костенко"],
              correctAnswer: 1
            },
            {
              id: 2,
              text: "У якому році було написано поему \"Мойсей\"?",
              options: ["1905", "1893", "1913", "1900"],
              correctAnswer: 0
            },
            {
              id: 3,
              text: "Кому І. Франко присвятив поему \"Мойсей\"?",
              options: ["Своїй дружині", "Українському народові", "Т. Шевченку", "Своїм дітям"],
              correctAnswer: 1
            },
            {
              id: 4,
              text: "Скільки років Мойсей водив свій народ пустелею?",
              options: ["20 років", "30 років", "40 років", "50 років"],
              correctAnswer: 2
            },
            {
              id: 5,
              text: "Яке основне завдання ставив перед собою Мойсей?",
              options: ["Завоювати нові землі", "Збагатити свій народ", "Вивести народ із рабства і привести до обіцяної землі", "Стати правителем"],
              correctAnswer: 2
            },
            {
              id: 6,
              text: "Як називалася обіцяна земля в поемі?",
              options: ["Палестина", "Ханаан", "Єрусалим", "Ізраїль"],
              correctAnswer: 1
            },
            {
              id: 7,
              text: "Який символічний образ використовує Франко для змалювання темних сил?",
              options: ["Єгова", "Азазель", "Ханаан", "Датан"],
              correctAnswer: 1
            },
            {
              id: 8,
              text: "Який зв'язок вбачав І. Франко між долею біблійного Мойсея і долею поета в суспільстві?",
              options: ["Вони обидва були ізгоями", "Вони обидва були пророками для свого народу", "Вони обидва були багатими", "Вони обидва жили в пустелі"],
              correctAnswer: 1
            },
            {
              id: 9,
              text: "У яку гору піднявся Мойсей в кінці свого життя?",
              options: ["Сінай", "Нево", "Сіон", "Арарат"],
              correctAnswer: 1
            },
            {
              id: 10,
              text: "Скільки речей Єгова забороняє побачити Мойсеєві?",
              options: ["1", "2", "3", "4"],
              correctAnswer: 2
            },
            {
              id: 11,
              text: "Хто з персонажів поеми найбільше критикував Мойсея?",
              options: ["Авірон", "Датан і Авірон", "Азазель", "Єгошуа"],
              correctAnswer: 1
            },
            {
              id: 12,
              text: "Що символізує образ Мойсея в поемі?",
              options: ["Політичного діяча", "Духовного провідника народу, інтелігенцію", "Релігійного фанатика", "Звичайну людину"],
              correctAnswer: 1
            }
          ];
        } else if (test.title.includes("Спадщина Франка")) {
          generatedQuestions = [
            {
              id: 1,
              text: "У якому році народився Іван Франко?",
              options: ["1856", "1866", "1846", "1876"],
              correctAnswer: 0
            },
            {
              id: 2,
              text: "Як називалася перша збірка Івана Франка?",
              options: ["\"З вершин і низин\"", "\"Зів'яле листя\"", "\"Балади і розкази\"", "\"Каменярі\""],
              correctAnswer: 0
            },
            {
              id: 3,
              text: "Який псевдонім використовував Іван Франко?",
              options: ["Лесь Мартович", "Мирон", "Марко Вовчок", "Джеджалик"],
              correctAnswer: 1
            },
            {
              id: 4,
              text: "У якому університеті навчався Іван Франко?",
              options: ["Київський університет", "Харківський університет", "Львівський університет", "Варшавський університет"],
              correctAnswer: 2
            },
            {
              id: 5,
              text: "Яку науку вивчав Іван Франко в університеті?",
              options: ["Філософію", "Філологію", "Право", "Медицину"],
              correctAnswer: 1
            },
            {
              id: 6,
              text: "Хто є автором рядків: \"Лиш боротись — значить жить...\"?",
              options: ["Тарас Шевченко", "Іван Франко", "Леся Українка", "Михайло Коцюбинський"],
              correctAnswer: 1
            },
            {
              id: 7,
              text: "Який художній твір є автобіографічним для Івана Франка?",
              options: ["\"Перехресні стежки\"", "\"Украдене щастя\"", "\"Борислав сміється\"", "\"Оборона Буші\""],
              correctAnswer: 0
            },
            {
              id: 8,
              text: "У якому жанрі написано твір \"Украдене щастя\"?",
              options: ["Драма", "Комедія", "Трагедія", "Роман"],
              correctAnswer: 0
            },
            {
              id: 9,
              text: "Який твір Івана Франка присвячено нафтовим розробкам у Галичині?",
              options: ["\"Перехресні стежки\"", "\"Борислав сміється\"", "\"Захар Беркут\"", "\"Земля\""],
              correctAnswer: 1
            },
            {
              id: 10,
              text: "У якому році помер Іван Франко?",
              options: ["1906", "1916", "1926", "1936"],
              correctAnswer: 1
            },
            {
              id: 11,
              text: "Хто є головним героєм твору \"Захар Беркут\"?",
              options: ["Захар Беркут", "Максим Беркут", "Тугар Вовк", "Мирослава"],
              correctAnswer: 0
            },
            {
              id: 12,
              text: "До якого літературного напряму належала творчість Івана Франка?",
              options: ["Романтизм", "Реалізм і модернізм", "Класицизм", "Сентименталізм"],
              correctAnswer: 1
            }
          ];
        } else {
          // Загальний набір питань для цитат, якщо не впізнано конкретний тест
          generatedQuestions = [
            {
              id: 1,
              text: "Хто автор цитати: \"Якби ви вчились так, як треба, то й мудрість би була своя.\"?",
              options: ["Тарас Шевченко", "Іван Франко", "Григорій Сковорода", "Леся Українка"],
              correctAnswer: 0
            },
            {
              id: 2,
              text: "Хто автор цитати: \"Лиш боротись - значить жить...\"?",
              options: ["Тарас Шевченко", "Іван Франко", "Леся Українка", "Василь Стус"],
              correctAnswer: 1
            },
            {
              id: 3,
              text: "Хто автор цитати: \"Слово, чому ти не твердая криця?\"?",
              options: ["Тарас Шевченко", "Іван Франко", "Леся Українка", "Ліна Костенко"],
              correctAnswer: 2
            },
            {
              id: 4,
              text: "Хто автор цитати: \"Страшні слова, коли вони мовчать\"?",
              options: ["Тарас Шевченко", "Василь Симоненко", "Павло Тичина", "Ліна Костенко"],
              correctAnswer: 3
            },
            {
              id: 5,
              text: "Хто автор цитати: \"Борітеся – поборете! Вам Бог помагає!\"?",
              options: ["Тарас Шевченко", "Іван Франко", "Леся Українка", "Володимир Сосюра"],
              correctAnswer: 0
            },
            {
              id: 6,
              text: "Хто автор цитати: \"Книги – морська глибина: хто в них пірне аж до дна, той, хоч і труду мав досить, дивнії перли виносить\"?",
              options: ["Григорій Сковорода", "Іван Франко", "Леся Українка", "Тарас Шевченко"],
              correctAnswer: 1
            },
            {
              id: 7,
              text: "Хто автор цитати: \"Contra spem spero\" (Без надії сподіваюсь)?",
              options: ["Тарас Шевченко", "Іван Франко", "Леся Українка", "Ліна Костенко"],
              correctAnswer: 2
            }
          ];
        }
      } else if (test.testType === "character") {
        // Питання для тесту на персонажів
        if (test.title.includes("Літературні герої") || test.title.includes("Герої та їх автори")) {
          generatedQuestions = [
            {
              id: 1,
              text: "З якого твору персонаж Чіпка Варениченко?",
              options: ["Хіба ревуть воли, як ясла повні?", "Захар Беркут", "Кайдашева сім'я", "Тіні забутих предків"],
              correctAnswer: 0
            },
            {
              id: 2,
              text: "З якого твору персонаж Мавка?",
              options: ["Тіні забутих предків", "Лісова пісня", "Камінний хрест", "Земля"],
              correctAnswer: 1
            },
            {
              id: 3,
              text: "З якого твору персонаж Микола Джеря?",
              options: ["Кайдашева сім'я", "Хіба ревуть воли, як ясла повні?", "Микола Джеря", "Захар Беркут"],
              correctAnswer: 2
            },
            {
              id: 4,
              text: "З якого твору персонаж Іван Палійчук?",
              options: ["Мойсей", "Земля", "Камінний хрест", "Тіні забутих предків"],
              correctAnswer: 3
            },
            {
              id: 5,
              text: "З якого твору персонаж Маруся Чурай?",
              options: ["Маруся Чурай", "Наталка Полтавка", "Тіні забутих предків", "Лісова пісня"],
              correctAnswer: 0
            },
            {
              id: 6,
              text: "З якого твору персонаж Еней?",
              options: ["Наталка Полтавка", "Енеїда", "Мартин Боруля", "Мойсей"],
              correctAnswer: 1
            },
            {
              id: 7,
              text: "З якого твору персонаж Кайдашиха?",
              options: ["Микола Джеря", "Тіні забутих предків", "Кайдашева сім'я", "Хіба ревуть воли, як ясла повні?"],
              correctAnswer: 2
            },
            {
              id: 8,
              text: "З якого твору персонаж Захар Беркут?",
              options: ["Захар Беркут", "Тіні забутих предків", "Хіба ревуть воли, як ясла повні?", "Мойсей"],
              correctAnswer: 0
            },
            {
              id: 9,
              text: "З якого твору персонаж Михайло Гурман?",
              options: ["Украдене щастя", "Борислав сміється", "Оборона Буші", "Мартин Боруля"],
              correctAnswer: 0
            },
            {
              id: 10,
              text: "З якого твору персонаж Лукаш?",
              options: ["Тіні забутих предків", "Украдене щастя", "Лісова пісня", "Камінний хрест"],
              correctAnswer: 2
            },
            {
              id: 11,
              text: "З якого твору персонаж Наталка Полтавка?",
              options: ["Наталка Полтавка", "Маруся", "Маруся Чурай", "Лісова пісня"],
              correctAnswer: 0
            },
            {
              id: 12,
              text: "З якого твору персонаж Килина?",
              options: ["Украдене щастя", "Лісова пісня", "Тіні забутих предків", "Кайдашева сім'я"],
              correctAnswer: 1
            },
            {
              id: 13,
              text: "З якого твору персонаж Терпилиха?",
              options: ["Маруся Чурай", "Наталка Полтавка", "Катерина", "Земля"],
              correctAnswer: 1
            },
            {
              id: 14,
              text: "З якого твору персонаж Гриць Бобренко?",
              options: ["Наталка Полтавка", "Маруся Чурай", "Конотопська відьма", "Сватання на Гончарівці"],
              correctAnswer: 1
            },
            {
              id: 15,
              text: "З якого твору персонаж Возний Тетерваковський?",
              options: ["Конотопська відьма", "Наталка Полтавка", "Мартин Боруля", "Сватання на Гончарівці"],
              correctAnswer: 1
            },
            {
              id: 16,
              text: "З якого твору персонаж Грицько Голохвостий?",
              options: ["Наталка Полтавка", "Сватання на Гончарівці", "За двома зайцями", "Мартин Боруля"],
              correctAnswer: 2
            },
            {
              id: 17,
              text: "З якого твору персонаж Омелько Кайдаш?",
              options: ["Хіба ревуть воли, як ясла повні?", "Тіні забутих предків", "Кайдашева сім'я", "Захар Беркут"],
              correctAnswer: 2
            },
            {
              id: 18,
              text: "З якого твору персонаж Карпо Кайдаш?",
              options: ["Тіні забутих предків", "Захар Беркут", "Кайдашева сім'я", "Хіба ревуть воли, як ясла повні?"],
              correctAnswer: 2
            },
            {
              id: 19,
              text: "З якого твору персонаж Лавро Кайдаш?",
              options: ["Кайдашева сім'я", "Хіба ревуть воли, як ясла повні?", "Тіні забутих предків", "Захар Беркут"],
              correctAnswer: 0
            },
            {
              id: 20,
              text: "З якого твору персонаж Максим Гримач?",
              options: ["Максим Гримач", "Захар Беркут", "Земля", "Камінний хрест"],
              correctAnswer: 0
            }
          ];
        } else if (test.title.includes("Літературні характери") || test.title.includes("Характеристика персонажів")) {
          generatedQuestions = [
            {
              id: 1,
              text: "Який персонаж з \"Тіней забутих предків\" М. Коцюбинського найкраще характеризується як \"вільний духом гуцул, який живе в гармонії з природою\"?",
              options: ["Палагна", "Іван Палійчук", "Юра-мольфар", "Микуличин"],
              correctAnswer: 1
            },
            {
              id: 2,
              text: "Який персонаж з \"Кайдашевої сім'ї\" І. Нечуя-Левицького можна охарактеризувати як сварливу, владну жінку, яка постійно втручається в життя синів?",
              options: ["Мотря", "Мелашка", "Кайдашиха", "Палажка"],
              correctAnswer: 2
            },
            {
              id: 3,
              text: "Який персонаж з \"Лісової пісні\" Лесі Українки є уособленням творчого духу та волі до життя?",
              options: ["Лукаш", "Килина", "Мавка", "Лісовик"],
              correctAnswer: 2
            },
            {
              id: 4,
              text: "Який персонаж з роману \"Хіба ревуть воли, як ясла повні?\" є прикладом трагічної долі людини, яка вибрала шлях протесту і злочину?",
              options: ["Грицько", "Максим", "Чіпка Варениченко", "Лушня"],
              correctAnswer: 2
            },
            {
              id: 5,
              text: "Який персонаж з твору \"Енеїда\" І. Котляревського є головним героєм, що уособлює риси українського козацтва?",
              options: ["Дідона", "Низ", "Еней", "Турн"],
              correctAnswer: 2
            },
            {
              id: 6,
              text: "Який персонаж з драми \"Украдене щастя\" І. Франка є прикладом сільського жандарма, що повернувся до коханої через багато років?",
              options: ["Микола Задорожний", "Михайло Гурман", "Анна", "Олекса Бабич"],
              correctAnswer: 1
            },
            {
              id: 7,
              text: "Який персонаж з п'єси \"Наталка Полтавка\" І. Котляревського є прикладом вірної, працьовитої української дівчини?",
              options: ["Терпилиха", "Наталка", "Галя", "Маруся"],
              correctAnswer: 1
            },
            {
              id: 8,
              text: "Який персонаж з «Лісової пісні» Лесі Українки уособлює приземлений, практичний погляд на життя?",
              options: ["Мавка", "Килина", "Лукаш", "Перелесник"],
              correctAnswer: 1
            },
            {
              id: 9,
              text: "Який персонаж з роману «Маруся Чурай» Ліни Костенко є головною героїнею, народною піснетворкою?",
              options: ["Галя Вишняківна", "Маруся Чурай", "Маруся Богуславка", "Бондарівна"],
              correctAnswer: 1
            },
            {
              id: 10,
              text: "Який персонаж з твору «Тіні забутих предків» М. Коцюбинського є коханою Івана, що трагічно загинула?",
              options: ["Палагна", "Марічка", "Килина", "Мавка"],
              correctAnswer: 1
            },
            {
              id: 11,
              text: "Який персонаж з трагедії «Украдене щастя» І. Франка є чоловіком Анни, який уособлює покірність і слабкість?",
              options: ["Микола Задорожний", "Іван Калитка", "Михайло Гурман", "Лаврін Кайдаш"],
              correctAnswer: 0
            },
            {
              id: 12,
              text: "Який персонаж з комедії «Мартин Боруля» І. Карпенка-Карого є батьком, одержимим ідеєю отримати дворянство?",
              options: ["Герасим Калитка", "Мартин Боруля", "Омелько Кайдаш", "Терентій Пузир"],
              correctAnswer: 1
            },
            {
              id: 13,
              text: "Який персонаж з «Кайдашевої сім'ї» І. Нечуя-Левицького є другим сином Кайдашів, більш спокійним і врівноваженим?",
              options: ["Карпо", "Лаврін", "Омелько", "Грицько"],
              correctAnswer: 1
            },
            {
              id: 14,
              text: "Який персонаж з твору «Земля» О. Кобилянської є братовбивцею?",
              options: ["Михайло", "Сава", "Івоніка", "Тодорика"],
              correctAnswer: 1
            },
            {
              id: 15,
              text: "Який персонаж з повісті «Захар Беркут» І. Франка є мудрим старійшиною тухольської громади?",
              options: ["Максим", "Мирослава", "Захар Беркут", "Тугар Вовк"],
              correctAnswer: 2
            }
          ];
        } else {
          // Загальні питання про персонажів, якщо не впізнано конкретний тест
          generatedQuestions = [
            {
              id: 1,
              text: "З якого твору персонаж Чіпка Варениченко?",
              options: ["Хіба ревуть воли, як ясла повні?", "Захар Беркут", "Кайдашева сім'я", "Тіні забутих предків"],
              correctAnswer: 0
            },
            {
              id: 2,
              text: "З якого твору персонаж Мавка?",
              options: ["Тіні забутих предків", "Лісова пісня", "Камінний хрест", "Земля"],
              correctAnswer: 1
            },
            {
              id: 3,
              text: "З якого твору персонаж Микола Джеря?",
              options: ["Кайдашева сім'я", "Хіба ревуть воли, як ясла повні?", "Микола Джеря", "Захар Беркут"],
              correctAnswer: 2
            },
            {
              id: 4,
              text: "З якого твору персонаж Іван Палійчук?",
              options: ["Мойсей", "Земля", "Камінний хрест", "Тіні забутих предків"],
              correctAnswer: 3
            },
            {
              id: 5,
              text: "З якого твору персонаж Маруся Чурай?",
              options: ["Маруся Чурай", "Наталка Полтавка", "Тіні забутих предків", "Лісова пісня"],
              correctAnswer: 0
            },
            {
              id: 6,
              text: "З якого твору персонаж Еней?",
              options: ["Наталка Полтавка", "Енеїда", "Мартин Боруля", "Мойсей"],
              correctAnswer: 1
            },
            {
              id: 7,
              text: "З якого твору персонаж Кайдашиха?",
              options: ["Микола Джеря", "Тіні забутих предків", "Кайдашева сім'я", "Хіба ревуть воли, як ясла повні?"],
              correctAnswer: 2
            }
          ];
        }
      }
      
      // Обмежуємо кількість питань відповідно до test.questionCount
      if (generatedQuestions.length > test.questionCount) {
        generatedQuestions = generatedQuestions.slice(0, test.questionCount);
      }
      
      // Якщо питань менше, ніж потрібно - додаємо загальні питання
      while (generatedQuestions.length < test.questionCount) {
        generatedQuestions.push({
          id: generatedQuestions.length + 1,
          text: `Яким літературним творам присвячено найбільше літературознавчих досліджень?`,
          options: [
            "\"Енеїда\" І. Котляревського та \"Кобзар\" Т. Шевченка", 
            "\"Лісова пісня\" Лесі Українки та \"Тіні забутих предків\" М. Коцюбинського", 
            "\"Мойсей\" І. Франка та \"Маруся Чурай\" Л. Костенко", 
            "\"Хіба ревуть воли...\" Панаса Мирного та \"Кайдашева сім'я\" І. Нечуя-Левицького"
          ],
          correctAnswer: 0
        });
        
        // Додаємо ще кілька додаткових питань
        generatedQuestions.push({
          id: generatedQuestions.length + 1,
          text: `Які українські твори були екранізовані найбільше разів?`,
          options: [
            "\"Кайдашева сім'я\" та \"За двома зайцями\"", 
            "\"Тіні забутих предків\" та \"Лісова пісня\"", 
            "\"Захар Беркут\" та \"Земля\"", 
            "\"Камінний хрест\" та \"Царівна\""
          ],
          correctAnswer: 0
        });
        
        generatedQuestions.push({
          id: generatedQuestions.length + 1,
          text: `Які з цих творів українських авторів перекладені найбільшою кількістю мов?`,
          options: [
            "\"Собор\" О. Гончара та \"Тигролови\" І. Багряного", 
            "\"Кобзар\" Т. Шевченка та \"Лісова пісня\" Лесі Українки", 
            "\"Тіні забутих предків\" М. Коцюбинського та \"Мойсей\" І. Франка", 
            "\"Земля\" О. Кобилянської та \"Хіба ревуть воли, як ясла повні?\" Панаса Мирного"
          ],
          correctAnswer: 1
        });
      }
      
      setQuestions(generatedQuestions);
      
      // Ініціалізуємо порожні відповіді
      const initialAnswers: UserAnswer[] = generatedQuestions.map(q => ({
        questionId: q.id,
        answerId: null
      }));
      setUserAnswers(initialAnswers);
      
      // Встановлюємо час на тест
      setTimeLeft(test.time ? test.time * 60 : 1800); // 30 хвилин за замовчуванням
    }
  }, [test]);
  
  // Перевіримо, чи правильно встановлюється стан showResults
  useEffect(() => {
    console.log("Поточний стан showResults:", showResults);
  }, [showResults]);
  
  // Зворотній відлік часу
  useEffect(() => {
    console.log("Таймер: timeLeft =", timeLeft);
    
    // Перевірка - якщо timeLeft = 0, але є питання, потрібно не завершувати тест
    if (timeLeft === 0 && questions.length > 0 && !showResults) {
      // Тільки якщо тест вже був заповнений користувачем, завершуємо
      if (userAnswers.some(answer => answer.answerId !== null)) {
        console.log("Час вийшов, завершуємо тест");
        finishTest();
      } else {
        // Якщо користувач ще не відповів на жодне питання, даємо йому час
        console.log("Таймер автоматично не запущено, чекаємо на відповіді користувача");
      }
      return;
    }
    
    if (timeLeft > 0 && !showResults) {
      const timer = setTimeout(() => {
        setTimeLeft(timeLeft - 1);
      }, 1000);
      
      return () => clearTimeout(timer);
    }
  }, [timeLeft, showResults, questions.length, userAnswers]);
  
  // Ці функції більше не потрібні, оскільки у нас є статичний список питань
  
  // Обробка відповіді на запитання
  const handleAnswer = (answerId: number) => {
    const updatedAnswers = [...userAnswers];
    updatedAnswers[currentQuestionIndex].answerId = answerId;
    setUserAnswers(updatedAnswers);
  };
  
  // Перейти до наступного питання
  const goToNextQuestion = () => {
    if (currentQuestionIndex < questions.length - 1) {
      setCurrentQuestionIndex(currentQuestionIndex + 1);
    }
  };
  
  // Перейти до попереднього питання
  const goToPrevQuestion = () => {
    if (currentQuestionIndex > 0) {
      setCurrentQuestionIndex(currentQuestionIndex - 1);
    }
  };
  
  // Обчислення результату тесту
  const calculateResult = () => {
    let correctCount = 0;
    
    questions.forEach((question, index) => {
      if (userAnswers[index]?.answerId === question.correctAnswer) {
        correctCount++;
      }
    });
    
    return {
      totalQuestions: questions.length,
      correctAnswers: correctCount,
      score: correctCount, // Бали - це кількість правильних відповідей
      percentage: Math.round((correctCount / questions.length) * 100) // Відсоток для відображення
    };
  };
  
  // Завершення тесту, збереження результатів і показ результатів
  const finishTest = () => {
    console.log("finishTest викликано, зберігаємо результати і показуємо їх");
    const result = calculateResult();
    
    // Автоматично зберігаємо результати
    saveResultMutation.mutate(result.score);
    
    // Показуємо результати
    setShowResults(true);
  };
  
  // Мутація для збереження результатів тесту
  const saveResultMutation = useMutation({
    mutationFn: async (score: number) => {
      if (!user) throw new Error("Користувач не увійшов в систему");
      
      const data = {
        userId: user.id,
        testId: testId,
        score: score,
        completed: true,
        completedAt: new Date() // Відправляємо об'єкт Date замість рядка
      };
      
      const res = await apiRequest("POST", "/api/user/test-results", data);
      return await res.json();
    },
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: [`/api/user/test-results/${user?.id}`] });
      toast({
        title: "Успіх!",
        description: "Результати тесту успішно збережено",
      });
    },
    onError: (error: Error) => {
      toast({
        title: "Помилка",
        description: `Не вдалося зберегти результати: ${error.message}`,
        variant: "destructive",
      });
    }
  });
  
  // Збереження результатів тесту
  const saveResults = () => {
    const result = calculateResult();
    saveResultMutation.mutate(result.score);
  };
  
  // Форматування часу
  const formatTime = (seconds: number): string => {
    const mins = Math.floor(seconds / 60);
    const secs = seconds % 60;
    return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
  };
  
  // Обчислення прогресу проходження тесту
  const calculateProgress = (): number => {
    const answeredCount = userAnswers.filter(a => a.answerId !== null).length;
    return Math.round((answeredCount / questions.length) * 100);
  };
  
  if (isLoading || !test) {
    return (
      <div className="flex items-center justify-center min-h-screen">
        <div className="animate-spin h-8 w-8 border-4 border-primary border-t-transparent rounded-full"></div>
      </div>
    );
  }
  
  if (showResults) {
    const result = calculateResult();
    
    return (
      <div className="container mx-auto px-4 py-8 max-w-4xl">
        <div className="bg-white rounded-lg shadow-md p-6">
          <h1 className="text-2xl font-bold mb-6 text-center">Результати тесту</h1>
          <div className="text-center mb-8">
            <div className="text-6xl font-bold mb-2 text-primary">{result.percentage}%</div>
            <p className="text-lg text-gray-700">
              Ви відповіли правильно на {result.correctAnswers} з {result.totalQuestions} запитань
            </p>
            <p className="text-md text-gray-600 mt-1">
              Кількість балів: <span className="font-semibold">{result.score}/{result.totalQuestions}</span>
            </p>
            <p className="text-sm text-gray-500 mt-2">
              {saveResultMutation.isPending 
                ? <span className="flex items-center justify-center gap-1"><Loader2 size={14} className="animate-spin" /> Збереження результату...</span> 
                : <span className="flex items-center justify-center gap-1"><CheckCircle size={14} className="text-green-500" /> Результат автоматично збережено</span>}
            </p>
          </div>
          
          <div className="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
            <div className="bg-gray-50 p-4 rounded-lg">
              <h3 className="font-medium mb-2">Інформація про тест</h3>
              <p className="text-sm text-gray-700 mb-1"><span className="font-medium">Назва:</span> {test.title}</p>
              <p className="text-sm text-gray-700 mb-1"><span className="font-medium">Тип:</span> {test.testType === 'book' ? 'За твором' : test.testType === 'quote' ? 'Цитати' : 'Персонажі'}</p>
              <p className="text-sm text-gray-700"><span className="font-medium">Складність:</span> {test.difficulty === 'easy' ? 'Легкий' : test.difficulty === 'medium' ? 'Середній' : 'Складний'}</p>
            </div>
            
            <div className="bg-gray-50 p-4 rounded-lg">
              <h3 className="font-medium mb-2">Ваша статистика</h3>
              <p className="text-sm text-gray-700 mb-1"><span className="font-medium">Правильних відповідей:</span> {result.correctAnswers}</p>
              <p className="text-sm text-gray-700 mb-1"><span className="font-medium">Неправильних відповідей:</span> {result.totalQuestions - result.correctAnswers}</p>
              <p className="text-sm text-gray-700"><span className="font-medium">Оцінка:</span> {result.percentage >= 90 ? 'Відмінно!' : result.percentage >= 75 ? 'Добре' : result.percentage >= 60 ? 'Задовільно' : 'Потрібно повторити матеріал'}</p>
            </div>
          </div>
          
          <div className="bg-gray-50 p-4 rounded-lg mb-8">
            <h3 className="font-medium mb-3">Рекомендації з підготовки</h3>
            {result.percentage < 60 && (
              <div className="text-sm text-gray-700 mb-2">
                <p className="mb-2"><span className="font-medium">Ваш результат потребує вдосконалення.</span> Рекомендуємо:</p>
                <ul className="list-disc pl-5 space-y-1">
                  <li>Уважно прочитати твір "{test.title}" повністю</li>
                  <li>Ознайомитися з біографією автора та історичним контекстом</li>
                  <li>Звернути увагу на основних персонажів та їхні характеристики</li>
                  <li>Вивчити основні цитати та ключові моменти твору</li>
                </ul>
              </div>
            )}
            {result.percentage >= 60 && result.percentage < 75 && (
              <div className="text-sm text-gray-700 mb-2">
                <p className="mb-2"><span className="font-medium">Ваш результат задовільний, але є над чим працювати.</span> Рекомендуємо:</p>
                <ul className="list-disc pl-5 space-y-1">
                  <li>Повторно ознайомитися з ключовими моментами твору</li>
                  <li>Звернути увагу на роль другорядних персонажів</li>
                  <li>Опрацювати додаткові матеріали з аналізу твору</li>
                </ul>
              </div>
            )}
            {result.percentage >= 75 && result.percentage < 90 && (
              <div className="text-sm text-gray-700 mb-2">
                <p className="mb-2"><span className="font-medium">Ваш результат добрий!</span> Для ще кращого результату рекомендуємо:</p>
                <ul className="list-disc pl-5 space-y-1">
                  <li>Звернути увагу на символіку та художні засоби у творі</li>
                  <li>Ознайомитися з літературною критикою твору</li>
                  <li>Порівняти твір з іншими творами цього автора або періоду</li>
                </ul>
              </div>
            )}
            {result.percentage >= 90 && (
              <div className="text-sm text-gray-700 mb-2">
                <p className="mb-2"><span className="font-medium">Чудовий результат!</span> Ви відмінно знаєте матеріал.</p>
                <ul className="list-disc pl-5 space-y-1">
                  <li>Спробуйте тести підвищеної складності</li>
                  <li>Поглибте знання про літературний напрям та контекст твору</li>
                  <li>Ознайомтеся з сучасними інтерпретаціями твору</li>
                </ul>
              </div>
            )}
          </div>
          
          <div className="flex justify-center">
            <Button 
              variant="default" 
              className="flex items-center gap-2"
              onClick={() => navigate("/games")}
            >
              <ArrowLeft size={18} />
              Повернутися до ігор
            </Button>
          </div>
        </div>
      </div>
    );
  }
  
  const currentQuestion = questions[currentQuestionIndex];
  const progress = calculateProgress();
  
  // Додамо логи, щоб перевірити наявність питань
  console.log("Кількість питань:", questions.length);
  console.log("Поточне питання індекс:", currentQuestionIndex);
  console.log("Поточне питання:", currentQuestion);
  
  if (!currentQuestion) {
    console.error("Помилка: питання не знайдено!");
    return (
      <div className="flex items-center justify-center min-h-screen">
        <div className="text-center">
          <HelpCircle className="h-16 w-16 text-gray-400 mx-auto mb-4" />
          <p className="text-lg text-gray-700">Виникла помилка при завантаженні запитань</p>
          <Button 
            variant="default" 
            className="mt-4"
            onClick={() => navigate("/games")}
          >
            Повернутися до ігор
          </Button>
        </div>
      </div>
    );
  }
  
  return (
    <div className="container mx-auto px-4 py-8 max-w-4xl">
      <div className="bg-white rounded-lg shadow-md p-4 sm:p-6">
        <div className="flex justify-between items-center mb-6">
          <button 
            onClick={() => navigate("/games")}
            className="text-gray-500 hover:text-gray-700 flex items-center gap-1 text-sm"
          >
            <ArrowLeft size={16} />
            Вийти
          </button>
          
          <div className="text-lg font-medium">{test.title}</div>
          
          <div className="flex items-center gap-1 text-sm font-medium">
            <Clock size={16} className="text-gray-500" />
            <span className={timeLeft < 300 ? "text-red-500" : "text-gray-700"}>
              {formatTime(timeLeft)}
            </span>
          </div>
        </div>
        
        <div className="mb-4 bg-gray-100 rounded-full h-2.5">
          <div 
            className="bg-primary h-2.5 rounded-full" 
            style={{ width: `${progress}%` }}
          ></div>
        </div>
        
        <div className="mb-2 flex justify-between text-sm text-gray-500">
          <div>Запитання {currentQuestionIndex + 1} з {questions.length}</div>
          <div>{progress}% виконано</div>
        </div>
        
        <div className="mb-8">
          <h2 className="text-lg sm:text-xl font-medium mb-6">{currentQuestion.text}</h2>
          
          <div className="space-y-3">
            {currentQuestion.options.map((option, index) => (
              <div 
                key={index}
                className={`
                  border rounded-lg p-3 sm:p-4 cursor-pointer transition-all
                  ${userAnswers[currentQuestionIndex]?.answerId === index 
                    ? 'border-primary bg-primary/5' 
                    : 'border-gray-200 hover:border-gray-300 bg-white'}
                `}
                onClick={() => handleAnswer(index)}
              >
                <div className="flex items-center gap-3">
                  <div className={`
                    flex items-center justify-center w-6 h-6 rounded-full text-sm
                    ${userAnswers[currentQuestionIndex]?.answerId === index 
                      ? 'bg-primary text-white' 
                      : 'bg-gray-100 text-gray-700'}
                  `}>
                    {String.fromCharCode(65 + index)}
                  </div>
                  <div>{option}</div>
                </div>
              </div>
            ))}
          </div>
        </div>
        
        <div className="flex justify-between">
          <Button 
            variant="outline" 
            onClick={goToPrevQuestion}
            disabled={currentQuestionIndex === 0}
          >
            Попереднє
          </Button>
          
          {currentQuestionIndex < questions.length - 1 ? (
            <Button 
              variant="default" 
              onClick={goToNextQuestion}
              disabled={userAnswers[currentQuestionIndex]?.answerId === null}
            >
              Наступне
            </Button>
          ) : (
            <Button 
              variant="default" 
              onClick={finishTest}
              disabled={userAnswers.some(a => a.answerId === null)}
            >
              Завершити тест
            </Button>
          )}
        </div>
      </div>
    </div>
  );
}